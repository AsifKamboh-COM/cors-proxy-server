<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CORS Proxy Server</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .spinner {
            animation: spin 1s linear infinite;
        }

        .error-message {
            margin-top: 10px;
            color: #ff4444;
            font-size: 14px;
            font-weight: bold;
            display: block;
        }

        pre {
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .response-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .response-header {
            padding: 10px;
            background-color: #2d3748;
            border-radius: 8px;
            color: #38b2ac;
            font-weight: bold;
            margin-bottom: 12px;
        }

        .response-html {
            padding: 15px;
            background-color: #1a202c;
            border-radius: 8px;
            color: #f6ad55;
            overflow-y: auto;
            max-height: 400px;
            white-space: pre-line;
        }

        .response-card {
            background-color: #2d3748;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .loading-btn {
            position: relative;
        }

        .spinner-hidden {
            display: none;
        }
    </style>
</head>
<body class="bg-gray-900 text-white flex flex-col items-center min-h-screen p-6">
    <!-- Main container -->
    <div class="w-full max-w-xl bg-gray-800 p-8 rounded-lg shadow-lg text-center space-y-6">
        <h1 class="text-3xl font-bold text-blue-400 mb-4">CORS Proxy Server</h1>
        <p class="text-lg text-gray-400 mb-6">Enter a URL to fetch the response through the CORS proxy server.</p>

        <!-- Input Section -->
        <div class="flex flex-col space-y-4">
            <input type="text" id="urlInput" placeholder="Enter URL to fetch" 
                class="w-full p-4 text-gray-800 rounded-md focus:ring focus:ring-blue-500 placeholder-gray-500 shadow-lg">
            
            <!-- Button with loading state -->
            <button id="fetchButton" onclick="fetchData()" 
                class="px-6 py-3 bg-blue-500 hover:bg-blue-600 rounded-md shadow-md transition-colors duration-300 relative"
                disabled>
                <span id="buttonText">Fetch Data</span>
                <div id="spinner" class="spinner-hidden absolute inset-0 flex items-center justify-center">
                    <div class="spinner w-6 h-6 border-4 border-white border-t-transparent rounded-full"></div>
                </div>
            </button>

            <!-- Error Message -->
            <span id="errorMessage" class="error-message hidden">Please enter a valid URL to fetch data.</span>
        </div>
    </div>

    <!-- Output Section -->
    <div id="outputContainer" class="w-full max-w-2xl mt-8 hidden bg-gray-800 p-6 rounded-lg shadow-lg space-y-6">
        <div class="response-container">
            <div class="response-card">
                <h2 class="text-xl font-semibold text-green-400 mb-4">Response Headers</h2>
                <pre id="headersOutput" class="response-header"></pre>
            </div>

            <div class="response-card">
                <h2 class="text-xl font-semibold text-yellow-400 mb-4">HTML Response</h2>
                <div id="htmlOutput" class="response-html"></div>
            </div>
        </div>
    </div>

    <script>
        // DOM Elements
        const elements = {
            urlInput: document.getElementById('urlInput'),
            fetchButton: document.getElementById('fetchButton'),
            buttonText: document.getElementById('buttonText'),
            spinner: document.getElementById('spinner'),
            errorMessage: document.getElementById('errorMessage'),
            outputContainer: document.getElementById('outputContainer'),
            headersOutput: document.getElementById('headersOutput'),
            htmlOutput: document.getElementById('htmlOutput')
        };

        // State management
        let isFetching = false;

        // Input validation
        function isValidUrl(url) {
            try {
                return Boolean(new URL(url));
            } catch {
                return false;
            }
        }

        // UI Helpers
        function showLoading() {
            elements.spinner.classList.remove('spinner-hidden');
            elements.buttonText.classList.add('invisible');
            elements.fetchButton.disabled = true;
        }

        function hideLoading() {
            elements.spinner.classList.add('spinner-hidden');
            elements.buttonText.classList.remove('invisible');
            elements.fetchButton.disabled = false;
        }

        function showError(message) {
            elements.errorMessage.textContent = message;
            elements.errorMessage.classList.remove('hidden');
            elements.outputContainer.classList.add('hidden');
        }

        function clearError() {
            elements.errorMessage.classList.add('hidden');
            elements.errorMessage.textContent = '';
        }

        // Main function
        async function fetchData() {
            if (isFetching) return;
            
            const url = elements.urlInput.value.trim();
            clearError();
            
            if (!url || !isValidUrl(url)) {
                showError('Please enter a valid URL to fetch data.');
                return;
            }

            try {
                isFetching = true;
                showLoading();
                
                const proxyUrl = `/proxy?url=${encodeURIComponent(url)}`;
                const response = await fetch(proxyUrl);
                
                if (!response.ok) {
                    throw new Error(`Server responded with ${response.status}`);
                }

                const data = await response.json();

                if (data?.length > 0) {
                    elements.outputContainer.classList.remove('hidden');
                    elements.headersOutput.textContent = JSON.stringify(data[0].headers, null, 2);
                    elements.htmlOutput.innerHTML = data[0].html;  // Directly injecting HTML response
                } else {
                    showError('No data received from the server');
                }
            } catch (error) {
                console.error('Fetch error:', error);
                showError(`Error fetching data: ${error.message}`);
            } finally {
                isFetching = false;
                hideLoading();
            }
        }

        // Enable button when input is valid
        elements.urlInput.addEventListener('input', () => {
            elements.fetchButton.disabled = !isValidUrl(elements.urlInput.value.trim());
        });
    </script>
</body>
</html>
